{"ast":null,"code":"import _toConsumableArray from\"/home/shyam/Videos/reactProject/roomVChat/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/home/shyam/Videos/reactProject/roomVChat/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/home/shyam/Videos/reactProject/roomVChat/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";function _templateObject2(){var data=_taggedTemplateLiteral([\"\\n  height: 40%;\\n  width: 50%;\\n\"]);_templateObject2=function _templateObject2(){return data;};return data;}function _templateObject(){var data=_taggedTemplateLiteral([\"\\n  padding: 20px;\\n  display: flex;\\n  height: 100vh;\\n  width: 90%;\\n  margin: auto;\\n  flex-wrap: wrap;\\n\"]);_templateObject=function _templateObject(){return data;};return data;}import React,{useEffect,useRef,useState}from\"react\";import io from\"socket.io-client\";import Peer from\"simple-peer\";import styled from\"styled-components\";var Container=styled.div(_templateObject());var StyledVideo=styled.video(_templateObject2());var Video=function Video(props){var ref=useRef();useEffect(function(){props.peer.on(\"stream\",function(stream){ref.current.srcObject=stream;});},[props.peer]);return/*#__PURE__*/React.createElement(StyledVideo,{playsInline:true,autoPlay:true,ref:ref});};var videoConstraints={height:window.innerHeight/2,width:window.innerWidth/2};var socket=io.connect(\"https://videochatserver-evr8.onrender.com\");console.log(socket);var Room=function Room(props){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),peers=_useState2[0],setPeers=_useState2[1];// const socketRef = useRef();\nvar userVideo=useRef();var peersRef=useRef([]);var roomID=props.match.params.roomID;console.log(props);useEffect(function(){navigator.mediaDevices.getUserMedia({video:videoConstraints,audio:true}).then(function(stream){userVideo.current.srcObject=stream;socket.emit(\"join room\",roomID);socket.on(\"all users\",function(users){var peers=[];users.forEach(function(userID){var peer=createPeer(userID,socket.id,stream);peersRef.current.push({peerID:userID,peer:peer});peers.push(peer);});setPeers(peers);});socket.on(\"user joined\",function(payload){var peer=addPeer(payload.signal,payload.callerID,stream);peersRef.current.push({peerID:payload.callerID,peer:peer});setPeers(function(users){return[].concat(_toConsumableArray(users),[peer]);});});socket.on(\"receiving returned signal\",function(payload){var item=peersRef.current.find(function(p){return p.peerID===payload.id;});item.peer.signal(payload.signal);});});},[roomID]);function createPeer(userToSignal,callerID,stream){var peer=new Peer({initiator:true,trickle:false,stream:stream});peer.on(\"signal\",function(signal){socket.emit(\"sending signal\",{userToSignal:userToSignal,callerID:callerID,signal:signal});});return peer;}function addPeer(incomingSignal,callerID,stream){var peer=new Peer({initiator:false,trickle:false,stream:stream});peer.on(\"signal\",function(signal){socket.emit(\"returning signal\",{signal:signal,callerID:callerID});});peer.signal(incomingSignal);return peer;}return/*#__PURE__*/React.createElement(Container,null,/*#__PURE__*/React.createElement(StyledVideo,{muted:true,ref:userVideo,autoPlay:true,playsInline:true}),peers.map(function(peer,index){if(peer._remoteStreams!=null){return/*#__PURE__*/React.createElement(Video,{key:index,peer:peer});}return null;}));};export default Room;","map":{"version":3,"sources":["/home/shyam/Videos/reactProject/roomVChat/client/src/routes/Room.js"],"names":["React","useEffect","useRef","useState","io","Peer","styled","Container","div","StyledVideo","video","Video","props","ref","peer","on","stream","current","srcObject","videoConstraints","height","window","innerHeight","width","innerWidth","socket","connect","console","log","Room","peers","setPeers","userVideo","peersRef","roomID","match","params","navigator","mediaDevices","getUserMedia","audio","then","emit","users","forEach","userID","createPeer","id","push","peerID","payload","addPeer","signal","callerID","item","find","p","userToSignal","initiator","trickle","incomingSignal","map","index","_remoteStreams"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\nimport io from \"socket.io-client\";\nimport Peer from \"simple-peer\";\nimport styled from \"styled-components\";\n\nconst Container = styled.div`\n  padding: 20px;\n  display: flex;\n  height: 100vh;\n  width: 90%;\n  margin: auto;\n  flex-wrap: wrap;\n`;\n\nconst StyledVideo = styled.video`\n  height: 40%;\n  width: 50%;\n`;\n\nconst Video = (props) => {\n  const ref = useRef();\n  useEffect(() => {\n    props.peer.on(\"stream\", (stream) => {\n      ref.current.srcObject = stream;\n    });\n  }, [props.peer]);\n\n  return <StyledVideo playsInline autoPlay ref={ref} />;\n};\n\nconst videoConstraints = {\n  height: window.innerHeight / 2,\n  width: window.innerWidth / 2,\n};\n\nconst socket = io.connect(\n  \"https://videochatserver-evr8.onrender.com\"\n);\nconsole.log(socket);\n\nconst Room = (props) => {\n  const [peers, setPeers] = useState([]);\n  // const socketRef = useRef();\n  const userVideo = useRef();\n  const peersRef = useRef([]);\n  const roomID = props.match.params.roomID;\n  console.log(props);\n  useEffect(() => {\n    navigator.mediaDevices\n      .getUserMedia({ video: videoConstraints, audio: true })\n      .then((stream) => {\n        userVideo.current.srcObject = stream;\n        socket.emit(\"join room\", roomID);\n        socket.on(\"all users\", (users) => {\n          const peers = [];\n          users.forEach((userID) => {\n            const peer = createPeer(userID, socket.id, stream);\n            peersRef.current.push({\n              peerID: userID,\n              peer,\n            });\n            peers.push(peer);\n          });\n          setPeers(peers);\n        });\n\n        socket.on(\"user joined\", (payload) => {\n          const peer = addPeer(payload.signal, payload.callerID, stream);\n          peersRef.current.push({\n            peerID: payload.callerID,\n            peer,\n          });\n\n          setPeers((users) => [...users, peer]);\n        });\n\n        socket.on(\"receiving returned signal\", (payload) => {\n          const item = peersRef.current.find((p) => p.peerID === payload.id);\n          item.peer.signal(payload.signal);\n        });\n      });\n  }, [roomID]);\n\n  function createPeer(userToSignal, callerID, stream) {\n    const peer = new Peer({\n      initiator: true,\n      trickle: false,\n      stream,\n    });\n\n    peer.on(\"signal\", (signal) => {\n      socket.emit(\"sending signal\", {\n        userToSignal,\n        callerID,\n        signal,\n      });\n    });\n\n    return peer;\n  }\n\n  function addPeer(incomingSignal, callerID, stream) {\n    const peer = new Peer({\n      initiator: false,\n      trickle: false,\n      stream,\n    });\n\n    peer.on(\"signal\", (signal) => {\n      socket.emit(\"returning signal\", { signal, callerID });\n    });\n\n    peer.signal(incomingSignal);\n\n    return peer;\n  }\n\n  return (\n    <Container>\n      <StyledVideo muted ref={userVideo} autoPlay playsInline />\n      {peers.map((peer, index) => {\n        if (peer._remoteStreams != null) {\n          return <Video key={index} peer={peer} />;\n        }\n        return null;\n      })}\n    </Container>\n  );\n};\n\nexport default Room;\n"]},"metadata":{},"sourceType":"module"}